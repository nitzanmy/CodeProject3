<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>הרשמה - מיכל פילאטיס</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="registiration.css">
</head>
<body>
   <div id="navbar-placeholder"></div>

    <h1>ברוכה הבאה לסטודיו של מיכל</h1>
    <h3>אנא מלאו את הפרטים הבאים:</h3>

    <form id="registrationForm" novalidate>
        
        <div>
            <label for="firstName">שם פרטי:</label><br>
            <input type="text" id="firstName" name="firstName" placeholder="ישראל" required>
        </div>
        <br>

        <div>
            <label for="lastName">שם משפחה:</label><br>
            <input type="text" id="lastName" name="lastName" placeholder="ישראלי" required>
        </div>
        <br>

        <div>
            <label for="birthdate">תאריך לידה:</label><br>
            <input type="date" id="birthdate" name="birthdate" required>
        </div>
        <br>

        <div>
            <label for="city">מקום מגורים:</label><br>
            <input type="text" id="city" name="city" placeholder="תל אביב">
        </div>
        <br>

        <div>
            <label>מספר טלפון:</label><br>
            <div style="direction: ltr; display: flex; justify-content: flex-end; gap: 5px;">
                <select id="phonePrefix" name="phonePrefix" required>
                    <option value="050">050</option>
                    <option value="052">052</option>
                    <option value="053">053</option>
                    <option value="054">054</option>
                    <option value="055">055</option>
                    <option value="058">058</option>
                </select>
                - 
                <input type="tel" id="phoneNumber" name="phoneNumber" 
                       placeholder="1234567" 
                       maxlength="7" 
                       oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                       required>
            </div>
        </div>
        <br>

        <div>
            <label for="email">אימייל:</label><br>
            <input type="email" id="email" name="email" placeholder="example@mail.com" required>
        </div>
        <br>

        <div>
            <label for="password">סיסמא (חייבת לכלול אותיות ומספרים):</label><br>
            <input type="password" id="password" name="password" 
                   pattern="(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,}" 
                   title="הסיסמא חייבת להכיל לפחות 6 תווים, כולל מספר אחד ואות אחת" 
                   placeholder="לפחות 6 תווים" required>
        </div>
        <br>

        <div>
            <label for="confirmPassword">אימות סיסמא:</label><br>
            <input type="password" id="confirmPassword" name="confirmPassword" placeholder="הקלידו שוב את הסיסמא" required>
        </div>
        <br>

        <div>
            <label>האם מתאמן באופן קבוע?</label><br>
            
            <input type="radio" id="habit1" name="trainingHabits" value="מתאמן מעל 8 אימונים" required>
            <label for="habit1">מתאמן מעל 8 אימונים בחודש</label><br>

            <input type="radio" id="habit2" name="trainingHabits" value="מתאמן 4-8 אימונים">
            <label for="habit2">מתאמן בין 4-8 אימונים בחודש</label><br>

            <input type="radio" id="habit3" name="trainingHabits" value="מתאמן קבוע">
            <label for="habit3">מתאמן באופן קבוע</label><br>

            <input type="radio" id="habit4" name="trainingHabits" value="לא מתאמן">
            <label for="habit4">לא מתאמן כרגע</label>
        </div>
        <br>

        <div>
            <a href="https://docs.google.com/forms/d/e/1FAIpQLSfmtBn1AUXFf8qQMP3BC6aQK7Z-2mbS54zbtnt8jqQ1V9ldVA/viewform" target="_blank">
                <button type="button">נא למלא את הצהרת הבריאות</button>
            </a>
        </div>
        <br>

        <div>
            <label for="comments">הערות נוספות:</label><br>
            <textarea id="comments" name="comments" rows="4" cols="50" placeholder="הערות מיוחדות, פציעות עבר וכו'"></textarea>
        </div>
        <br>
        
        <button type="submit">הרשמה</button>

    </form>

    <hr>
    
    <div id="footer-placeholder"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        
        fetch('navbar.html').then(r => r.text()).then(d => document.getElementById('navbar-placeholder').innerHTML = d);
        fetch('footer.html').then(r => r.text()).then(d => document.getElementById('footer-placeholder').innerHTML = d);

        function containsNumbers(str) {
            return /\d/.test(str);
        }

        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        //  פונקציה חדשה לחישוב גיל
        function calculateAge(birthDateString) {
            const today = new Date();
            const birthDate = new Date(birthDateString);
            
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();
            
            // בדיקה אם יום ההולדת עוד לא הגיע השנה
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            return age;
        }

        //  הסקריפט הראשי
        document.getElementById('registrationForm').addEventListener('submit', function(e) {
            e.preventDefault(); 

            // בדיקת שדות חובה
            const requiredIds = ['firstName', 'lastName', 'birthdate', 'phoneNumber', 'email', 'password', 'confirmPassword'];
            for (let id of requiredIds) {
                if (!document.getElementById(id).value) {
                    alert('נא למלא את כל שדות החובה (' + document.querySelector(`label[for="${id}"]`)?.innerText.replace(':', '') + ')');
                    return;
                }
            }
            if (!document.querySelector('input[name="trainingHabits"]:checked')) {
                alert('נא לבחור הרגלי אימון');
                return;
            }

            // בדיקת גיל 
            const birthdateValue = document.getElementById('birthdate').value;
            const age = calculateAge(birthdateValue);
            
            if (age < 16) {
                alert('רישום לסטודיו מגיל 16 ומעלה');
                return; // עוצר את ההרשמה
            }

            // בדיקת אימייל
            const email = document.getElementById('email').value;
            if (!isValidEmail(email)) {
                alert('כתובת המייל שהוזנה אינה תקינה. נא לוודא שיש @ ונקודה.');
                return;
            }

            //  בדיקת טלפון
            const phoneNumber = document.getElementById('phoneNumber').value;
            if (phoneNumber.length !== 7) {
                alert('מספר הטלפון חייב להכיל בדיוק 7 ספרות (ללא הקידומת)');
                return;
            }

            // בדיקת שמות
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const city = document.getElementById('city').value;

            if (containsNumbers(firstName)) {
                alert('שם פרטי לא יכול להכיל מספרים');
                return;
            }
            if (containsNumbers(lastName)) {
                alert('שם משפחה לא יכול להכיל מספרים');
                return;
            }
            if (city.length > 0 && containsNumbers(city)) {
                alert('שם העיר לא יכול להכיל מספרים');
                return;
            }

            // בדיקת סיסמאות
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (password !== confirmPassword) {
                alert('הסיסמאות אינן תואמות!');
                return; 
            }

            // שמירה ב-LocalStorage
            const phonePrefix = document.getElementById('phonePrefix').value;
            const fullPhone = phonePrefix + '-' + phoneNumber;
            let habit = document.querySelector('input[name="trainingHabits"]:checked').value;
            const comments = document.getElementById('comments').value;

            localStorage.setItem('userEmail', email);
            localStorage.setItem('userPassword', password);
            localStorage.setItem('userName', firstName);
            localStorage.setItem('userLastName', lastName);
            localStorage.setItem('userBirthdate', birthdateValue);
            localStorage.setItem('userCity', city);
            localStorage.setItem('userPhone', fullPhone);
            localStorage.setItem('userHabit', habit);
            localStorage.setItem('userComments', comments);

            alert('ההרשמה בוצעה בהצלחה! כל הפרטים נשמרו במערכת. מועבר להתחברות...');
            
            setTimeout(function() {
                window.location.href = "login.html";
            }, 500);
        });
    </script>

</body>
</html>
